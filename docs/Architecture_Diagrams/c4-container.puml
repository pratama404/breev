@startuml C4 Container Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Container Diagram - AQI Monitoring System

Person(user, "Building Occupant", "Uses QR codes to access room data")
Person(admin, "Facility Manager", "Manages sensors and system")

System_Boundary(aqi, "AQI Monitoring System") {
    Container(web, "Web Application", "Next.js, React", "Provides dashboard and admin interface")
    Container(api, "API Gateway", "Next.js API Routes", "Handles HTTP requests and responses")
    
    Container(ingestor, "Data Ingestor", "Python, Paho-MQTT", "Subscribes to MQTT and stores to DB")
    Container(ml, "Inference Service", "Python, FastAPI, PyTorch", "Provides AQI predictions via API")
    
    ContainerDb(db, "Timeseries Database", "MongoDB Atlas", "Stores sensor logs, users, and predictions")
    Container(mqtt, "MQTT Broker", "EMQX Cloud", "Managed Message broker for IoT")
}

System_Ext(mobile, "Mobile Device", "Smartphone with QR scanner")
System_Ext(dagshub, "DagsHub", "ML Experiment Tracking")

Rel(user, mobile, "Scans QR codes")
Rel(mobile, web, "Views dashboards", "HTTPS")
Rel(admin, web, "Manages system", "HTTPS")

Rel(web, api, "Makes requests", "HTTP/JSON")
Rel(api, db, "Queries data", "MongoDB Protocol")
Rel(api, ml, "Requests predictions", "HTTP/REST")
Rel(api, mqtt, "Publishes commands (optional)", "MQTTS")

Rel(mqtt, ingestor, "Pushes telemetry", "MQTTS")
Rel(ingestor, db, "Stores sensor data", "MongoDB Protocol")

Rel(ml, db, "Fetches historical data", "MongoDB Protocol")
Rel(ml, dagshub, "Logs metrics", "HTTPS")

@enduml