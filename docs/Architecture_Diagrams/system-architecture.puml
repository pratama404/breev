@startuml System Architecture
!define RECTANGLE class

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

package "IoT Edge Layer" {
  [ESP32 Controller] as ESP32
  [MQ135 Gas Sensor] as MQ135
  [DHT22 Temp/Humidity] as DHT22
  
  ESP32 --> MQ135 : ADC Read
  ESP32 --> DHT22 : Digital Read
}

package "Communication Layer" {
  [WiFi Network] as WiFi
  [MQTT Broker (EMQX)] as MQTT
  
  ESP32 --> WiFi : 802.11 b/g/n
  WiFi --> MQTT : TCP/IP (SSL/TLS)
}

package "Data Processing Layer" {
  [Ingestor Service] as Ingestor
  [MongoDB Atlas] as MongoDB
  
  MQTT --> Ingestor : Subscribe (aqi/sensor/+/telemetry)
  Ingestor --> MongoDB : Store Sensor Logs
}

package "Intelligence Layer" {
  [AirPhyNet Model (PyTorch)] as ML
  [Hyperparam Search] as Tuner
  [DagsHub (MLflow)] as DagsHub
  
  MongoDB --> ML : Training Data
  Tuner --> ML : Optimize Parameters
  ML --> DagsHub : Log Metrics & Artifacts
}

package "Application Layer" {
  [Next.js API Gateway] as API
  [Admin Dashboard] as Admin
  [QR Scan Page] as Public
  
  MongoDB --> API : Fetch Data
  API --> Admin : Device Status & Metrics
  API --> Public : Real-time AQI & Gauges
}

package "User Interface" {
  [Admin PC] as PC
  [Mobile User] as Mobile
  
  PC --> Admin : Manage System
  Mobile --> Public : Scan QR
}

@enduml