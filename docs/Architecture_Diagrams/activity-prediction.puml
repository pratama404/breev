@startuml Activity - AI Prediction
title Ref: UC-AI-01 (Generate Forecast)

start
:Receive Prediction Request;
:Extract 'sensor_id' from Payload;

partition "Data Preparation" {
    :Query MongoDB 'sensor_logs';
    :Fetch last 24h data (sliding window);
    if (Data Points < 100?) then (yes)
        :Error: Insufficient Data;
        stop
    else (no)
        :Normalize Data (0-1 Scale);
        :Create Tensor [Batch, Seq, Feature];
    endif
}

partition "AI Inference (PyTorch)" {
    :Load Pre-trained LSTM Model;
    :Forward Pass (Input Tensor);
    :Get Output Tensor (Next 6h);
    :Denormalize Output;
}

:Format JSON Response;
:Return Forecast Array;

stop
@enduml