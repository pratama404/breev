@startuml Deployment Diagram - Breev Hybrid
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Deployment.puml

title Deployment Diagram - Breev Hybrid Architecture

Deployment_Node(user_device, "User Device", "Mobile/Desktop Browser") {
    Container(browser, "Web Client", "Chrome/Safari")
}

Deployment_Node(iot_device, "Monitoring Location", "ESP32 Device") {
    Container(firmware, "Breev Firmware", "C++", "Reads sensors and sends HTTPS")
}

Deployment_Node(cloud_vercel, "Vercel Cloud", "Serverless Infrastructure") {
    Container(frontend, "Next.js Application", "React/SSR", "Admin Dashboard & Public Views")
}

Deployment_Node(cloud_mongo, "MongoDB Atlas", "Database-as-a-Service") {
    ContainerDb(db, "Breev Database", "MongoDB", "Sensor Logs & Users")
}

Deployment_Node(premise, "On-Premise Server", "Proxmox VM / Ubuntu") {
    Deployment_Node(docker, "Docker Host") {
        Container(tunnel, "Cloudflare Tunnel", "cloudflared", "Secure Ingress")
        Container(backend, "FastAPI Backend", "Python:3.9", "Business Logic & AI")
        Container(mqtt, "EMQX Broker", "Erlang", "MQTT Bridge (Optional)")
    }
}

' Connections
Rel(browser, frontend, "HTTPS", "Visit Dashboard")
Rel(frontend, tunnel, "API Calls", "HTTPS/JSON")
Rel(iot_device, tunnel, "Ingest Data", "HTTPS/POST")

Rel(tunnel, backend, "Forward Traffic", "Local TCP/8000")
Rel(backend, db, "Read/Write", "Mongo Wire Protocol (TLS)")
Rel(frontend, db, "Read/Write (Server Actions)", "Mongo Wire Protocol (TLS)")

@enduml